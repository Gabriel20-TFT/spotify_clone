{% extends 'music/base.html' %}

{% block title %}{{ song.title }} - Spotify Clone{% endblock %}

{% block content %}
<div class="container mt-5">
  <!-- Song Header -->
  <div class="song-header mb-5 p-5 text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 20px;">
    <div class="row align-items-center">
      <div class="col-md-4 text-center">
        <!-- Cover Image -->
        <div class="song-cover-large mx-auto">
          {% if song.cover_image %}
            <img src="{{ song.cover_image.url }}" alt="{{ song.title }}" class="img-fluid rounded shadow-lg">
          {% else %}
            <div class="cover-placeholder">
              <i class="fa-solid fa-music fa-5x"></i>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="col-md-8">
        <p class="text-uppercase small mb-2" style="letter-spacing: 2px; opacity: 0.8;">Melodie</p>
        <h1 class="display-3 fw-bold mb-3">{{ song.title }}</h1>

        <!-- Artists -->
        <div class="song-artists mb-3">
          <i class="fa-solid fa-user-music me-2"></i>
          <span class="fs-4">
            {% for artist in song.artists.all %}
              <a href="{% url 'artist_detail' artist.id %}" class="text-white text-decoration-none fw-bold">
                {{ artist.name }}
              </a>{% if not forloop.last %}, {% endif %}
            {% empty %}
              <span class="fst-italic">Artist necunoscut</span>
            {% endfor %}
          </span>
        </div>

        <!-- Album -->
        {% if song.album %}
          <div class="song-album mb-3">
            <i class="fa-solid fa-compact-disc me-2"></i>
            <a href="{% url 'album_detail' song.album.id %}" class="text-white text-decoration-none fs-5">
              {{ song.album.title }}
            </a>
          </div>
        {% endif %}

        <!-- Duration -->
        {% if song.duration %}
          <div class="song-duration">
            <i class="fa-solid fa-clock me-2"></i>
            <span>{{ song.duration }}</span>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Mesaje -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Audio Player Section -->
  {% if song.audio_file %}
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8">
        <div class="card border-0 shadow-lg" style="border-radius: 20px;">
          <div class="card-body p-5">
            <h3 class="text-center mb-4">
              <i class="fa-solid fa-headphones me-2 text-primary"></i>
              Ascultă acum
            </h3>

            <!-- Audio Player -->
            <div class="audio-player-container mb-4">
              <audio id="mainPlayer" controls class="w-100" style="height: 60px; border-radius: 15px;">
                <source src="{{ song.audio_file.url }}" type="audio/mpeg">
                Browserul tău nu suportă redarea audio.
              </audio>
            </div>

            <!-- Actions -->
            <div class="d-flex gap-3 justify-content-center flex-wrap">
              <a href="{% url 'download_song' song.id %}" class="btn btn-success btn-lg" style="border-radius: 12px;">
                <i class="fa-solid fa-download me-2"></i>
                Descarcă melodia
              </a>

              <button class="btn btn-outline-primary btn-lg" style="border-radius: 12px;" data-bs-toggle="modal" data-bs-target="#shareModal">
                <i class="fa-solid fa-share-nodes me-2"></i>
                Distribuie
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-warning text-center" role="alert">
      <i class="fa-solid fa-exclamation-triangle fa-2x mb-3"></i>
      <h4>Fișier audio indisponibil</h4>
      <p class="mb-0">Această melodie nu are un fișier audio încărcat.</p>
    </div>
  {% endif %}

  <!-- Song Info Card -->
  <div class="row justify-content-center mb-5">
    <div class="col-lg-8">
      <div class="card border-0 shadow" style="border-radius: 15px;">
        <div class="card-body p-4">
          <h4 class="mb-4">
            <i class="fa-solid fa-info-circle me-2 text-info"></i>
            Informații melodie
          </h4>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="info-item p-3" style="background: #f8f9fa; border-radius: 10px;">
                <small class="text-muted d-block mb-1">Artiști</small>
                <strong>
                  {% for artist in song.artists.all %}
                    {{ artist.name }}{% if not forloop.last %}, {% endif %}
                  {% empty %}
                    Necunoscut
                  {% endfor %}
                </strong>
              </div>
            </div>

            <div class="col-md-6">
              <div class="info-item p-3" style="background: #f8f9fa; border-radius: 10px;">
                <small class="text-muted d-block mb-1">Album</small>
                <strong>
                  {% if song.album %}
                    <a href="{% url 'album_detail' song.album.id %}" class="text-decoration-none">
                      {{ song.album.title }}
                    </a>
                  {% else %}
                    Single
                  {% endif %}
                </strong>
              </div>
            </div>

            {% if song.duration %}
            <div class="col-md-6">
              <div class="info-item p-3" style="background: #f8f9fa; border-radius: 10px;">
                <small class="text-muted d-block mb-1">Durată</small>
                <strong>{{ song.duration }}</strong>
              </div>
            </div>
            {% endif %}

            <div class="col-md-6">
              <div class="info-item p-3" style="background: #f8f9fa; border-radius: 10px;">
                <small class="text-muted d-block mb-1">Format</small>
                <strong>MP3 Audio</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="d-flex gap-3 justify-content-center flex-wrap">
    <a href="{% url 'song_list' %}" class="btn btn-outline-secondary btn-lg" style="border-radius: 12px;">
      <i class="fa-solid fa-arrow-left me-2"></i>
      Toate melodiile
    </a>

    {% if song.album %}
      <a href="{% url 'album_detail' song.album.id %}" class="btn btn-outline-primary btn-lg" style="border-radius: 12px;">
        <i class="fa-solid fa-compact-disc me-2"></i>
        Vezi albumul
      </a>
    {% endif %}

    <a href="{% url 'index' %}" class="btn btn-outline-success btn-lg" style="border-radius: 12px;">
      <i class="fa-solid fa-home me-2"></i>
      Acasă
    </a>
  </div>
</div>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="shareModalLabel">
          <i class="fa-solid fa-share-nodes me-2"></i>
          Distribuie melodia
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-4">
        <p class="lead">{{ song.title }}</p>
        <div class="d-flex gap-3 justify-content-center">
          <button class="btn btn-primary btn-lg" onclick="alert('Funcție în curând!')">
            <i class="fa-brands fa-facebook"></i>
          </button>
          <button class="btn btn-info btn-lg" onclick="alert('Funcție în curând!')">
            <i class="fa-brands fa-twitter"></i>
          </button>
          <button class="btn btn-success btn-lg" onclick="alert('Link copiat!')">
            <i class="fa-solid fa-link"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Song Header */
  .song-header {
    animation: fadeIn 0.6s ease;
    box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4);
  }

  /* Cover Image */
  .song-cover-large {
    max-width: 350px;
  }

  .song-cover-large img {
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    transition: all 0.4s ease;
  }

  .song-cover-large img:hover {
    transform: scale(1.05) rotate(-2deg);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
  }

  .cover-placeholder {
    width: 350px;
    height: 350px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
  }

  /* Links in header */
  .song-artists a:hover,
  .song-album a:hover {
    text-decoration: underline !important;
  }

  /* Audio Player */
  .audio-player-container audio {
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
  }

  /* Cards */
  .card {
    animation: fadeInUp 0.6s ease;
  }

  /* Buttons */
  .btn-lg {
    padding: 12px 30px;
    font-weight: 600;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
  }

  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Info items hover */
  .info-item {
    transition: all 0.3s ease;
  }

  .info-item:hover {
    background: #e9ecef !important;
    transform: translateY(-2px);
  }
</style>
{% endblock %}
